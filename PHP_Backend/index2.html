<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>Milliomos project</title>
        <meta charset="UTF-8">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script>
            var session_user="";
            var questions;
            var previous=[];
            function Load(data){
                questions=data;
            }
            function ShowSignup(){
                $("#signup_form").css("display","block");
                $("#login_form").css("display","none");
            }
            function ShowLogin(){
                $("#signup_form").css("display","none");
                $("#login_form").css("display","block");
            }
            function ShowMainMenu(user){
                $("#login_form").css("display","none");
                $("#mainmenu").css("display","block");
                $("#greet").append(user);
            }
            function ShowPlayground(){
                $("#mainmenu").css("display","none");
                $("#playground").css("display","block");
            }
            function Signup(){
                var username=$("input[name='s_username']").val();
                var email=$("input[name='s_email']").val();
                var password=$("input[name='s_password']").val();
                $.ajax({
                    type:'POST',
                    url:'signup.php',
                    data:'email='+email+'&username='+username+'&password='+password,
                    success: function (data) {
                        if(data==="successful")  {alert("Successful registration. You can login now."); ShowLogin();}
                        else if (data==="empty") alert ("You need to fill all fields");
                        else if (data==="exist") alert("This user/email already exist");
                    },
                    error: function(){alert("Something went wrong");}
                });
            }
            function Login(){
                var username=$("input[name='l_username']").val();
                var password=$("input[name='l_password']").val();
                $.ajax({
                   type:'POST',
                   url:'login.php',
                   data:'username='+username+'&password='+password,
                   success: function(data){
                       if(data==="false") alert("Wrong username or password");
                       else {
                           session_user=username;
                           alert(data);
                           ShowMainMenu(session_user);
                       }
                   },
                   error: function(){alert("Something went wrong");}
                });
            }
            function GetQuestions(questionnumber){
                $.ajax({
                    type:'POST',
                    url:'./getQuestions.php',
                    data:'questionnumber='+questionnumber,
                    dataType:'json',
                    success: function (data)
                    {
                        Load(data);
                    }
                }); 
            }
            function SelectQuestion() {
                questionnumber=10;
                var rnd=Math.floor(Math.random()*(questionnumber-1));
                if (!previous.includes(questions[rnd].id)) {
                    var selected=[];
                    selected[0]=questions[rnd].id;
                    selected[1]=questions[rnd].question;
                    selected[2]=questions[rnd].right0;
                    selected[3]=questions[rnd].wrong1;
                    selected[4]=questions[rnd].wrong2;
                    selected[5]=questions[rnd].wrong3;
                    selected[6]=questions[rnd].level;
                    previous.push(selected[0]);
                    
                    return selected;
                }
                else SelectQuestion();
            }
            function StartGame(){
                ShowPlayground();
                GetQuestions(10);
                FillQuestion();
                //$("#questiontext").text(SelectQuestion()[1]);
            }
            function FillQuestion(){
                var q=SelectQuestion();
                alert(q);
                $("#questiontext").text(q[1]);
                var i=1;
                var filled=[];
                while(i<=4) {
                    var rnd=Math.floor(Math.random()*4+2);
                    //alert(filled+" "+rnd+" "+i);
                    if (!filled.includes(rnd) && rnd<=5 &&rnd>=2) {
                        $("#answer"+i).val(q[rnd]);
                        filled.push(rnd);
                        i++;
                    }
                    else if(filled.length<4) rnd=Math.floor(Math.random()*4+2); 
                }
            }
        </script>
        <style>
            #welcome{display:block;}
            #signup_form {display:none;}
            #login_form{display:none;}
            #mainmenu{display:none;}
            #playground{display:none;}
        </style>
    </head>
    <body>
        <div id="welcome">
            <input type="button" value="Signup" onclick="ShowSignup();">
            <input type="button" value="Login" onclick="ShowLogin();">
        </div>
        <div id="signup_form">
            <h1>Registration</h1>
            <div>
                <label>Email: </label>
                <input type="text" name="s_email">
            </div>
            <div>
                <label>Username: </label>
                <input type="text" name="s_username">
            </div>
            <div>
                <label>Password: </label>
                <input type="password" name="s_password">
            </div>
            <input type="button" value="Sign up" onclick="Signup();">
        </div>
        <div id="login_form">
            <h1>Login</h1>
            <div>
                <label>Username: </label>
                <input type="text" name="l_username">
            </div>
            <div>
                <label>Password: </label>
                <input type="password" name="l_password">
            </div>
            <input type="button" value="Log in" onclick="Login();">
        </div>
        <div id="mainmenu">
            <h1 id="greet">Welcome </h1>
            <input type="button" value="Start a game" onclick="StartGame();">
        </div>
        <div id="playground">
            <h3 id="questiontext"></h3>
            <input type="button" id="answer1" value="asd" onclick="">
            <input type="button" id="answer2" value="asd" onclick="">
            <input type="button" id="answer3" value="asd" onclick="">
            <input type="button" id="answer4" value="asd" onclick="">
        </div>
    </body>
</html>
